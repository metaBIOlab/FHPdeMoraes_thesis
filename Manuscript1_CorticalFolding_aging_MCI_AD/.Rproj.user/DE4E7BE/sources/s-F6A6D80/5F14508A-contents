# importa os arquivos----

LobesExtract_ALL <-
  as_tibble(
    read_delim(
      "data/LobesExtract_ALL.txt",
      ";",
      escape_double = FALSE,
      locale = locale(),
      trim_ws = TRUE
    )
  )

# REORGANIZAÇÃO DAS MEDIDAS ----
# DIVIDE POR TIPO DE MEDIDA ----
source("organiza/lobeextract_variables.R")

# JUNTA AS MEDIDAS EM UMA ÚNICA TABELA ----

LobesExtract_ALL_results <-
  right_join(
    right_join(
      right_join(
        right_join(
          right_join(
            right_join(
              LobesExtract_ALL_TotalArea,
              LobesExtract_ALL_AvgThickness,
              by = c("ID", "nROI", "hemi")
            ),
            LobesExtract_ALL_SmoothArea,
            by = c("ID", "nROI", "hemi")
          ),
          LobesExtract_ALL_K_ds,
          by = c("ID", "nROI", "hemi")
        ),
        LobesExtract_ALL_SmoothArea_ds,
        by = c("ID", "nROI", "hemi")
      ),
      LobesExtract_ALL_K_CHwoB,
      by = c("ID", "nROI", "hemi")
    ),
    LobesExtract_ALL_SmoothArea_CHwoB,
    by = c("ID", "nROI", "hemi")
  )

LobesExtract_ALL_results <- unique(LobesExtract_ALL_results)

# RENOMEIA ID PARA SUBJ_ses ----
names(LobesExtract_ALL_results)[1] <- "SUBJ_antigo"

# DELETA AS TABELAS POR MEDIDAS ----

rm(LobesExtract_ALL_TotalArea, LobesExtract_ALL_AvgThickness, LobesExtract_ALL_SmoothArea, LobesExtract_ALL_K_ds, LobesExtract_ALL_SmoothArea_ds, LobesExtract_ALL_K_CHwoB, LobesExtract_ALL_SmoothArea_CHwoB)

# NOMEIA AS ROIS ----

LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 1] <-
  "CC"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 2] <-
  "F"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 3] <-
  "P"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 4] <-
  "T"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 5] <-
  "O"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 6] <-
  "Insula"

names(LobesExtract_ALL_results)[2] <- "ROI"

LobesExtract_ALL_results$ROI <-
  as.factor(LobesExtract_ALL_results$ROI)

# ----
colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "ExposedArea")] <-
  "ExposedArea"
colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "SmoothArea_ds")] <-
  "ExposedArea_ds"
colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "SmoothArea_CHwoB")] <-
  "ExposedArea_CHwoB"

# verificacao dos sujeitos com ExposedArea == 0 -----
#verificar_SmoothArea_zero <- filter(LobesExtract_ALL_results, ExposedArea == 0, K_CHwoB == 0)
#write.csv(verificar_SmoothArea_zero, "verificar_SmoothArea_zero.csv")

# limpeza - tira os sujeitos com ExposedArea == 0 ---
#LobesExtract_ALL_results <- filter(LobesExtract_ALL_results, ExposedArea != 0, K_CHwoB != 0)

# FATOR DE CORREÇÃO c ----

LobesExtract_ALL_results <- mutate(
  LobesExtract_ALL_results,
  SUBJ = str_c("SUBJ", str_sub(SUBJ_antigo,-3,-1)),
  Session = ifelse(
    str_sub(SUBJ_antigo, 1, 2) == "PR" |
      str_sub(SUBJ_antigo, 1, 2) == "DA" |
      str_sub(SUBJ_antigo, 1, 2) == "SU",
    "1",
    ifelse(
      str_sub(SUBJ_antigo, 1, 2) == "SE",
      "2",
      ifelse(str_sub(SUBJ_antigo, 1, 2) == "TE", "3", "4")
    )
  ),
  localGI = TotalArea / ExposedArea,
  logAvgThickness = log10(AvgThickness),
  logTotalArea = log10(TotalArea),
  logExposedArea = log10(ExposedArea),
  logkteorico = 1 / 2 * logAvgThickness + logTotalArea - 5 / 4 * logExposedArea, c = 4 * pi / K_CHwoB,
  TotalArea_corrected = TotalArea * c,
  ExposedArea_corrected = ExposedArea * c,
  localGI_corrected = TotalArea_corrected / ExposedArea_corrected,
  logTotalArea_corrected = log10(TotalArea_corrected),
  logExposedArea_corrected = log10(ExposedArea_corrected),
  logkteorico_corrected = 1 / 2 * logAvgThickness + logTotalArea_corrected - 5 / 4 * logExposedArea_corrected,
  Longitudinal_correction = "no"
)

LobesExtract_ALL_results <- dplyr::select(LobesExtract_ALL_results, -c(SUBJ_antigo))
LobesExtract_ALL_results$Session <- as.double(LobesExtract_ALL_results$Session)
