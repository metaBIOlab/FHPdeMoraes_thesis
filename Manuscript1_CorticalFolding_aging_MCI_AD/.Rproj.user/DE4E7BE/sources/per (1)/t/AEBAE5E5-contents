# importa os arquivos----

LobesExtract_ALL <-
  as.tibble(
    read_delim(
      "data/LobesExtract_ALL.txt",
      ";",
      escape_double = FALSE,
      locale = locale(),
      trim_ws = TRUE
    )
  )

# REORGANIZAÇÃO DAS MEDIDAS ----
# DIVIDE POR TIPO DE MEDIDA ----
source("organiza/lobeextract_variables.R")

# JUNTA AS MEDIDAS EM UMA ÚNICA TABELA ----

LobesExtract_ALL_results <-
  right_join(
    right_join(
      right_join(
        right_join(
          right_join(
            right_join(
              LobesExtract_ALL_TotalArea,
              LobesExtract_ALL_AvgThickness,
              by = c("ID", "nROI", "hemi")
            ),
            LobesExtract_ALL_SmoothArea,
            by = c("ID", "nROI", "hemi")
          ),
          LobesExtract_ALL_K_ds,
          by = c("ID", "nROI", "hemi")
        ),
        LobesExtract_ALL_SmoothArea_ds,
        by = c("ID", "nROI", "hemi")
      ),
      LobesExtract_ALL_K_CHwoB,
      by = c("ID", "nROI", "hemi")
    ),
    LobesExtract_ALL_SmoothArea_CHwoB,
    by = c("ID", "nROI", "hemi")
  )

LobesExtract_ALL_results <- unique(LobesExtract_ALL_results)

# RENOMEIA ID PARA SUBJ_ses ----
names(LobesExtract_ALL_results)[1] <- "SUBJ_ID"

# DELETA AS TABELAS POR MEDIDAS ----

rm(LobesExtract_ALL_TotalArea)
rm(LobesExtract_ALL_AvgThickness)
rm(LobesExtract_ALL_SmoothArea)
rm(LobesExtract_ALL_K_ds)
rm(LobesExtract_ALL_SmoothArea_ds)
rm(LobesExtract_ALL_K_CHwoB)
rm(LobesExtract_ALL_SmoothArea_CHwoB)

# NOMEIA AS ROIS ----
source("organiza/lobeextract_roi.R")

colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "SmoothArea")] <-
  "ExposedArea"
colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "SmoothArea_ds")] <-
  "ExposedArea_ds"
colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "SmoothArea_CHwoB")] <-
  "ExposedArea_CHwoB"

# verificacao dos sujeitos com SmoothArea == 0 -----
#verificar_SmoothArea_zero <- filter(LobesExtract_ALL_results, SmoothArea == 0, K_CHwoB == 0)
#write.csv(verificar_SmoothArea_zero, "verificar_SmoothArea_zero.csv")

# limpeza - tira os sujeitos com SmoothArea == 0 ---
#LobesExtract_ALL_results <- filter(LobesExtract_ALL_results, SmoothArea != 0, K_CHwoB != 0)

# FATOR DE CORREÇÃO c ----

LobesExtract_ALL_results <- mutate(
  LobesExtract_ALL_results,
  localGI = TotalArea / ExposedArea,
  logAvgThickness = log(AvgThickness),
  logTotalArea = log(TotalArea),
  logExposedArea = log(ExposedArea),
  logkteorico = 1 / 2 * logAvgThickness + logTotalArea - 5 / 4 * logExposedArea,
  c = 4 * pi / K_CHwoB,
  TotalArea_corrected = TotalArea * c,
  ExposedArea_corrected = ExposedArea * c,
  localGI_corrected = TotalArea_corrected / ExposedArea_corrected,
  logTotalArea_corrected = log(TotalArea_corrected),
  logExposedArea_corrected = log(ExposedArea_corrected),
  logkteorico_corrected = 1 / 2 * logAvgThickness + logTotalArea_corrected - 5 / 4 * logExposedArea_corrected
)
