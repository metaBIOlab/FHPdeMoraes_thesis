# PREPARO

# define a area de trabalho
setwd("Z:/PRJ1513_GIRIFICACAO_CONTROLES/03_PROCS/STATISTICS/V6/")# se no idor
# setwd("E:/idor/Gyrification/") # se no pendrive
# setwd("C:/Users/fernanda.hansen/Desktop/aging/V6/") # se no pendrive
# setwd("C:/Users/ferna/Documents/idor/Gyrification/Processamento_longitudinal/V6/") # se no computador

# carrega os pacotes utilizados
source("01-call_packages.R")

# Chama as funcoes
source("02-funcoes.R")

# onde estao os arquivos de resultados:
path <- str_c("Z:/PRJ1513_GIRIFICACAO_CONTROLES/03_PROCS/PROC_DATA/STATS/long_tables/")
# path <- str_c("C:/Users/ferna/Documents/idor/Gyrification/Processamento_longitudinal/V6/data/resultados/")

#path_yujiangscript <- str_c("Z:/PRJ1513_GIRIFICACAO_CONTROLES/03_PROCS/PROC_DATA/STATS/Wang_code_extraction/")
# path_yujiangscript <- str_c("C:/Users/ferna/Documents/idor/Gyrification/Processamento_longitudinal/V6/data/resultados/")

path_yujiangscript_newsurfaces <- str_c("Z:/PRJ1513_GIRIFICACAO_CONTROLES/03_PROCS/STATISTICS/V6/data/resultados/")
# path_yujiangscript <- str_c("C:/Users/ferna/Documents/idor/Gyrification/Processamento_longitudinal/V6/data/resultados/")

path_lobes <- str_c("Z:/PRJ1513_GIRIFICACAO_CONTROLES/03_PROCS/PROC_DATA/STATS/LobesScaling/")
# path_lobes <- str_c("C:/Users/ferna/Documents/idor/Gyrification/Processamento_longitudinal/V6/data/resultados/")

path_sessions <- str_c("Z:/PRJ1513_GIRIFICACAO_CONTROLES/03_PROCS/RAW_DATA/BIDS/")
# path_sessions <- str_c("C:/Users/ferna/Documents/idor/Gyrification/Processamento_longitudinal/V6/data/")

path_FA <- str_c("Z:/PRJ1513_GIRIFICACAO_CONTROLES/03_PROCS/RAW_DATA/BIDS/")
# path_FA <- str_c("C:/Users/ferna/Documents/idor/Gyrification/Processamento_longitudinal/V6/data/FA_CC/") 
 
# importa os resultados ----
source("03-import_files.R") # arquivos dos sujeitos

# organiza os arquivos ----
source("04-organiza.R")
# source("rotina_arquivos_neuroquant_comparisson.R")

dados_raw <- dados

verificar_lGI_zero <- filter(dados, localGI == 0 | is.na(localGI))
write.csv(verificar_lGI_zero, "verificar_lGI_zero.csv")

# retira os outros diagnosticos e deixa so quem tem machine definido
dados_all <- dados %>% filter(
    Diagnostic == "CONTROLE" |
      Diagnostic == "CCL" |
      Diagnostic == "ALZ", localGI != 0 | !is.na(ExposedArea), !is.infinite(logExposedArea)) %>% 
  droplevels()

dados_excluidos <- anti_join(dados_raw, dados_all)
write.csv(dados_excluidos, "dados_excluidos.csv")

dados <- dados_all

# Prepara os dados para analise ----
source("05-analises_prep.R")

# deixa so Philips

#dados$Diagnostic[dados$Diagnostic == "CONTROLE"] <- "Control"
#dados$Diagnostic[dados$Diagnostic == "ALZ"] <- "AD"
#dados$Diagnostic[dados$Diagnostic == "MCI"] <- "MCI"

dados <- filter(dados, machine == "Philips-Achieva", Longitudinal_correction == "yes")

# separa em arquivo de hemisferios e de lobos ----
dados_hemi_v1 <- filter(dados, ROI == "hemisphere", Session == 1, method == "FreeSurferStandard", Longitudinal_correction == "yes")

dados_hemi_v1$machine <- as.factor(dados_hemi_v1$machine)
dados_hemi_v1$sex <- as.factor(dados_hemi_v1$sex)
dados_hemi_v1$Session <- as.factor(dados_hemi_v1$Session)
dados_hemi_v1$age <- as.factor(dados_hemi_v1$age)
dados_hemi_v1$Gender <- as.factor(dados_hemi_v1$Gender)
dados_hemi_v1$Diagnostic <- as.factor(dados_hemi_v1$Diagnostic)
dados_hemi_v1$hemi <- as.factor(dados_hemi_v1$hemi)
dados_hemi_v1$ROI <- as.factor(dados_hemi_v1$ROI)

dados_lobos_v1 <- filter(dados, ROI == "F" | ROI == "T" | ROI == "O" | ROI == "P", Session == 1, method == "Yujiang_script")

dados_hemi_v1_CH <- filter(dados, ROI == "hemisphere", Session == 1, method == "Yujiang_script", Longitudinal_correction == "yes")

dados_hemi_v1_CH$age <- as.factor(dados_hemi_v1_CH$age)
dados_hemi_v1_CH$Age_interval <- as.factor(dados_hemi_v1_CH$Age_interval)
dados_hemi_v1_CH$Gender <- as.factor(dados_hemi_v1_CH$Gender)
dados_hemi_v1_CH$Diagnostic <- as.factor(dados_hemi_v1_CH$Diagnostic)
dados_hemi_v1_CH$hemi <- as.factor(dados_hemi_v1_CH$hemi)
dados_hemi_v1_CH$ROI <- as.factor(dados_hemi_v1_CH$ROI)