# COMPARING SLOPES - DATA BASES

# IMPORT ####

HCP500r <- read_delim("data/Amostras/HCP500r.csv", ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE)

NKI <- read_delim("data/Amostras/NKI.csv", ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE)

OASIS_healthy <- read_delim("data/Amostras/OASIS_healthy.csv", ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE)

ADNIControl_NonLongitudinal <- read_delim("data/Amostras/ADNIControl_NonLongitudinal.csv", ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE)

ADNIAD_NonLongitudinal <- read_delim("data/Amostras/ADNIAD_NonLongitudinal.csv", ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE)


# ORGANIZING ####
HCP500r <-
  HCP500r %>% mutate(Amostra = "HCP500r", Diagnostic = "CONTROLE", ROI = "hemisphere")

HCP500r_lh <- HCP500r %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_lh,TotalArea_lh,ExposedArea_lh, Diagnostic, ROI) %>% mutate(hemi = "L")
HCP500r_rh <- HCP500r %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_rh,TotalArea_rh,ExposedArea_rh, Diagnostic, ROI) %>% mutate(hemi = "R")

NKI <- NKI %>% mutate(Amostra = "NKI", Diagnostic = "CONTROLE", ROI = "hemisphere")

NKI_lh <- NKI %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_lh,TotalArea_lh,ExposedArea_lh, Diagnostic, ROI) %>% mutate(hemi = "L")
NKI_rh <- NKI %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_rh,TotalArea_rh,ExposedArea_rh, Diagnostic, ROI) %>% mutate(hemi = "R")

OASIS_healthy <-
  OASIS_healthy %>% mutate(Amostra = "OASIS_healthy", Diagnostic = "CONTROLE", ROI = "hemisphere") 

OASIS_healthy_lh <- OASIS_healthy %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_lh,TotalArea_lh,ExposedArea_lh, Diagnostic, ROI) %>% mutate(hemi = "L")
OASIS_healthy_rh <- OASIS_healthy %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_rh,TotalArea_rh,ExposedArea_rh, Diagnostic, ROI) %>% mutate(hemi = "R")

ADNIAD_NonLongitudinal <-
  ADNIAD_NonLongitudinal %>% mutate(Amostra = "ADNIAD_NonLongitudinal", Diagnostic = "ALZ", ROI = "hemisphere") 

ADNIAD_NonLongitudinal_lh <- ADNIAD_NonLongitudinal %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_lh,TotalArea_lh,ExposedArea_lh, Diagnostic, ROI) %>% mutate(hemi = "L")
ADNIAD_NonLongitudinal_rh <- ADNIAD_NonLongitudinal %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_rh,TotalArea_rh,ExposedArea_rh, Diagnostic, ROI) %>% mutate(hemi = "R")

ADNIControl_NonLongitudinal <-
  ADNIControl_NonLongitudinal %>% mutate(Amostra = "ADNIControl_NonLongitudinal", Diagnostic = "CONTROLE", ROI = "hemisphere") 

ADNIControl_NonLongitudinal_lh <- ADNIControl_NonLongitudinal %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_lh,TotalArea_lh,ExposedArea_lh, Diagnostic, ROI) %>% mutate(hemi = "L")
ADNIControl_NonLongitudinal_rh <- ADNIControl_NonLongitudinal %>% dplyr::select(Amostra, Gender, Age, AvgCorticalThickness_rh,TotalArea_rh,ExposedArea_rh, Diagnostic, ROI) %>% mutate(hemi = "R")

datasets_yujiang_lh <- do.call("rbind", list(HCP500r_lh, NKI_lh, OASIS_healthy_lh, ADNIAD_NonLongitudinal_lh, ADNIControl_NonLongitudinal_lh))

datasets_yujiang_rh <- do.call("rbind", list(HCP500r_rh, NKI_rh, OASIS_healthy_rh, ADNIAD_NonLongitudinal_rh, ADNIControl_NonLongitudinal_rh))

colnames(datasets_yujiang_lh)[which(names(datasets_yujiang_lh) == "TotalArea_lh")] <-
  "TotalArea"

colnames(datasets_yujiang_lh)[which(names(datasets_yujiang_lh) == "ExposedArea_lh")] <-
  "ExposedArea"

colnames(datasets_yujiang_lh)[which(names(datasets_yujiang_lh) == "AvgCorticalThickness_lh")] <-
  "AvgThickness"

colnames(datasets_yujiang_rh)[which(names(datasets_yujiang_rh) == "TotalArea_rh")] <-
  "TotalArea"

colnames(datasets_yujiang_rh)[which(names(datasets_yujiang_rh) == "ExposedArea_rh")] <-
  "ExposedArea"

colnames(datasets_yujiang_rh)[which(names(datasets_yujiang_rh) == "AvgCorticalThickness_rh")] <-
  "AvgThickness"

datasets_yujiang <- rbind(datasets_yujiang_lh, datasets_yujiang_rh)


# DATA JOIN ####

dados_slope <- mutate(dados_hemi_v1, Amostra = "IDOR")
dados_slope <- dplyr::select(dados_slope, Gender, Age, AvgThickness, TotalArea, ExposedArea, hemi, Age_interval, Amostra, Diagnostic)

colnames(dados_slope)[which(names(dados_slope) == "Gender")] <-
  "Gender"

dados_slope$Gender <- as.factor(dados_slope$Gender)
datasets_yujiang$Gender <- as.factor(datasets_yujiang$Gender)
datasets_yujiang$Diagnostic <- as.factor(datasets_yujiang$Diagnostic)

dados_slope$Age <- as.character(dados_slope$Age)

dados_slope <- full_join(dados_slope, datasets_yujiang)

# AGE INTERVAL ####

# dados_slope$Age_interval[dados_slope$Age == "22-25"] <- "21-25"
# dados_slope$Age_interval[dados_slope$Age == "26-30"] <- "26-30"
# dados_slope$Age_interval[dados_slope$Age == "31-35"] <- "31-35"
# dados_slope$Age_interval[dados_slope$Age == "36+"] <- "36-40"
# 
# dados_slope$Age_interval[dados_slope$Age >= 10 &
#                                 dados_slope$Age < 15] <- "11-15"
# dados_slope$Age_interval[dados_slope$Age >= 15 &
#                                 dados_slope$Age < 20] <- "16-20"
# dados_slope$Age_interval[dados_slope$Age >= 20 &
#                                 dados_slope$Age < 25] <- "21-25"
# dados_slope$Age_interval[dados_slope$Age >= 25 &
#                                 dados_slope$Age < 30] <- "26-30"
# dados_slope$Age_interval[dados_slope$Age >= 30 &
#                                 dados_slope$Age < 35] <- "31-35"
# dados_slope$Age_interval[dados_slope$Age >= 35 &
#                                 dados_slope$Age < 40] <- "36-40"
# dados_slope$Age_interval[dados_slope$Age >= 40 &
#                                 dados_slope$Age < 45] <- "41-45"
# dados_slope$Age_interval[dados_slope$Age >= 45 &
#                                dados_slope$Age < 50] <- "46-50"
# dados_slope$Age_interval[dados_slope$Age >= 50 &
#                                dados_slope$Age < 55] <- "51-55"
# dados_slope$Age_interval[dados_slope$Age >= 55 &
#                                dados_slope$Age < 60] <- "56-60"
# dados_slope$Age_interval[dados_slope$Age >= 60 &
#                                dados_slope$Age < 65] <- "61-65"
# dados_slope$Age_interval[dados_slope$Age >= 65 &
#                                dados_slope$Age < 70] <- "66-70"
# dados_slope$Age_interval[dados_slope$Age >= 70 &
#                                dados_slope$Age < 75] <- "71-75"
# dados_slope$Age_interval[dados_slope$Age >= 75 &
#                                dados_slope$Age < 80] <- "76-80"
# dados_slope$Age_interval[dados_slope$Age >= 80 &
#                                dados_slope$Age < 85] <- "81-85"
# dados_slope$Age_interval[dados_slope$Age >= 85 &
#                                dados_slope$Age < 90] <- "86-90"
# dados_slope$Age_interval[dados_slope$Age >= 90 &
#                                 dados_slope$Age < 95] <- "91-95"
# dados_slope$Age_interval[dados_slope$Age >= 95 &
#                                 dados_slope$Age < 100] <- "96-100"
# dados_slope$Age_interval[dados_slope$Age == "95"] <- "91-95"

dados_slope$Age_interval[dados_slope$Age == "22-25"] <- "21"
dados_slope$Age_interval[dados_slope$Age == "26-30"] <- "26"
dados_slope$Age_interval[dados_slope$Age == "31-35"] <- "31"
dados_slope$Age_interval[dados_slope$Age == "36+"] <- "36"

dados_slope$Age_interval[dados_slope$Age >= 10 &
                                dados_slope$Age < 15] <- "11"
dados_slope$Age_interval[dados_slope$Age >= 15 &
                                dados_slope$Age < 20] <- "16"
dados_slope$Age_interval[dados_slope$Age >= 20 &
                                dados_slope$Age < 25] <- "21"
dados_slope$Age_interval[dados_slope$Age >= 25 &
                                dados_slope$Age < 30] <- "26"
dados_slope$Age_interval[dados_slope$Age >= 30 &
                                dados_slope$Age < 35] <- "31"
dados_slope$Age_interval[dados_slope$Age >= 35 &
                                dados_slope$Age < 40] <- "36"
dados_slope$Age_interval[dados_slope$Age >= 40 &
                                dados_slope$Age < 45] <- "41"
dados_slope$Age_interval[dados_slope$Age >= 45 &
                                dados_slope$Age < 50] <- "46"
dados_slope$Age_interval[dados_slope$Age >= 50 &
                                dados_slope$Age < 55] <- "51"
dados_slope$Age_interval[dados_slope$Age >= 55 &
                                dados_slope$Age < 60] <- "56"
dados_slope$Age_interval[dados_slope$Age >= 60 &
                                dados_slope$Age < 65] <- "61"
dados_slope$Age_interval[dados_slope$Age >= 65 &
                                dados_slope$Age < 70] <- "66"
dados_slope$Age_interval[dados_slope$Age >= 70 &
                                dados_slope$Age < 75] <- "71"
dados_slope$Age_interval[dados_slope$Age >= 75 &
                                dados_slope$Age < 80] <- "76"
dados_slope$Age_interval[dados_slope$Age >= 80 &
                                dados_slope$Age < 85] <- "81"
dados_slope$Age_interval[dados_slope$Age >= 85 &
                                dados_slope$Age < 90] <- "86"
dados_slope$Age_interval[dados_slope$Age >= 90 &
                                dados_slope$Age < 95] <- "91"
dados_slope$Age_interval[dados_slope$Age >= 95 &
                                dados_slope$Age < 100] <- "96"
dados_slope$Age_interval[dados_slope$Age == "95"] <- "91"

# ANALYSES ####

dados_slope$Diagnostic <- as.factor(dados_slope$Diagnostic)
dados_slope$Diagnostic = factor(dados_slope$Diagnostic, levels = c("CONTROLE", "CCL","ALZ"))

res.aov <- aov(AvgThickness ~ Amostra, data = dados_slope)
summary(res.aov)
TukeyHSD(res.aov)
  
my_comparisons_slope <- list( c("IDOR", "HCP500r"), c("IDOR", "NKI"), c("IDOR", "OASIS_healthy"), c("IDOR", "ADNIAD_NonLongitudinal"), c("IDOR", "ADNIControl_NonLongitudinal") )

ggplot(dados_slope, aes(log(ExposedArea),
                      1/2*log(AvgThickness) +log(TotalArea))) +
geom_point(aes(color = Amostra)) +
geom_smooth(method = "lm", se = FALSE) +
theme_pubclean()

ggplot(
  filter(dados_slope, Age_interval > 51 &
           Age_interval < 91 & Diagnostic == "CONTROLE" ),
  aes(
    x = Amostra,
    y = AvgThickness,
    fill = Amostra,
    color = Amostra
  )
) +
  geom_boxplot(aes(alpha = 0.5)) +
  ylim(1.5, 4) +
  facet_grid(. ~ Age_interval) +
  theme_pubclean() +
  stat_compare_means(label = "p.signif", method = "t.test", ref.group = "IDOR", hide.ns = TRUE, label.y = 3.5, method.args = list(alternative = "greater")) + 
  stat_compare_means(method = "anova", label.y = 4) +
  theme(axis.title = element_blank())

ggplot(
  filter(dados_slope, Age_interval > 51 &
           Age_interval < 91 & Diagnostic  == "ALZ" ),
  aes(
    x = Amostra,
    y = AvgThickness,
    fill = Amostra,
    color = Amostra
  )
) +
  geom_boxplot(aes(alpha = 0.5)) +
  ylim(1.5, 4) +
  facet_grid( . ~ Age_interval) +
  theme_pubclean() +
  stat_compare_means(label = "p.signif", method = "t.test", ref.group = "IDOR", hide.ns = TRUE, label.y = 3.5, method.args = list(alternative = "greater")) + 
  stat_compare_means(method = "anova", label.y = 4) +
  theme(axis.title = element_blank())


ggplot(
  filter(dados_slope, Age_interval > 51 &
           Age_interval < 91 & Diagnostic == "CONTROLE" ),
  aes(x = AvgThickness, color = Amostra, fill = Amostra)
) +
  geom_density(alpha = 0.3) +
  facet_grid(Age_interval ~ .) +
  theme_pubclean() + xlim (1.5, 3)

ggplot(
  filter(dados_slope, Age_interval > 51 &
           Age_interval < 91 & Diagnostic == "ALZ" ),
  aes(x = AvgThickness, color = Amostra, fill = Amostra)
) +
  geom_density(alpha = 0.3) +
  facet_grid(Age_interval ~ .) +
  theme_pubclean() + xlim (1.5, 3)