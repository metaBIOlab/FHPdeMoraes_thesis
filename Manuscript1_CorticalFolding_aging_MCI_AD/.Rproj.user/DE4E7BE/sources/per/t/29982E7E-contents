# importa os arquivos----

LobesExtract_ALL <-
  as_tibble(unique(read_delim(
    str_c(path_lobes,  "LobesExtract_ALL.csv"),
    ";",
    escape_double = FALSE,
    trim_ws = TRUE
  )))

# REORGANIZAÇÃO DAS MEDIDAS ----
# DIVIDE POR TIPO DE MEDIDA ----
source("organiza/lobeextract_variables.R")

# JUNTA AS MEDIDAS EM UMA ÚNICA TABELA ----

LobesExtract_ALL_results <-
  right_join(
    right_join(
      right_join(
        right_join(
          right_join(
            right_join(
              LobesExtract_ALL_TotalArea,
              LobesExtract_ALL_AvgThickness,
              by = c("ID", "nROI", "hemi")
            ),
            LobesExtract_ALL_SmoothArea,
            by = c("ID", "nROI", "hemi")
          ),
          LobesExtract_ALL_K_ds,
          by = c("ID", "nROI", "hemi")
        ),
        LobesExtract_ALL_SmoothArea_ds,
        by = c("ID", "nROI", "hemi")
      ),
      LobesExtract_ALL_K_CHwoB,
      by = c("ID", "nROI", "hemi")
    ),
    LobesExtract_ALL_SmoothArea_CHwoB,
    by = c("ID", "nROI", "hemi")
  )

LobesExtract_ALL_results <- unique(LobesExtract_ALL_results)

# RENOMEIA ID PARA SUBJ_ses ----
names(LobesExtract_ALL_results)[1] <- "SUBJ_ID"

# DELETA AS TABELAS POR MEDIDAS ----

rm(LobesExtract_ALL_TotalArea, LobesExtract_ALL_AvgThickness, LobesExtract_ALL_SmoothArea, LobesExtract_ALL_K_ds, LobesExtract_ALL_SmoothArea_ds, LobesExtract_ALL_K_CHwoB, LobesExtract_ALL_SmoothArea_CHwoB)

# NOMEIA AS ROIS ----

LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 1] <-
  "CC"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 2] <-
  "F"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 3] <-
  "P"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 4] <-
  "T"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 5] <-
  "O"
LobesExtract_ALL_results$nROI[LobesExtract_ALL_results$nROI == 6] <-
  "Insula"

names(LobesExtract_ALL_results)[2] <- "ROI"

LobesExtract_ALL_results$ROI <-
  as.factor(LobesExtract_ALL_results$ROI)

# ----
colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "ExposedArea")] <-
  "ExposedArea"
colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "SmoothArea_ds")] <-
  "ExposedArea_ds"
colnames(LobesExtract_ALL_results)[which(names(LobesExtract_ALL_results) == "SmoothArea_CHwoB")] <-
  "ExposedArea_CHwoB"

# verificacao dos sujeitos com ExposedArea == 0 -----
verificar_SmoothArea_zero <- filter(LobesExtract_ALL_results, ExposedArea == 0, K_CHwoB == 0)
write.csv(verificar_SmoothArea_zero, "verificar_SmoothArea_zero.csv")

# limpeza - tira os sujeitos com ExposedArea == 0 ---
LobesExtract_ALL_results <- filter(LobesExtract_ALL_results, ExposedArea != 0, K_CHwoB != 0)

# ----

LobesExtract_ALL_results <- LobesExtract_ALL_results %>% mutate(
  SUBJ = str_sub(LobesExtract_ALL_results$SUBJ_ID, 1, 7),
  Session = as.double(str_sub(LobesExtract_ALL_results$SUBJ_ID, 13, 13)),
  Longitudinal_correction = ifelse(str_sub(LobesExtract_ALL_results$SUBJ_ID, 23, 26) == "long", "yes", "no"),
  localGI = TotalArea / ExposedArea,
  logAvgThickness = log10(AvgThickness),
  logTotalArea = log10(TotalArea),
  logExposedArea = log10(ExposedArea),
  logkteorico = 1 / 2 * logAvgThickness + logTotalArea - 5 / 4 * logExposedArea,
  c = 4 * pi / K_CHwoB,
  TotalArea_corrected = TotalArea * c,
  ExposedArea_corrected = ExposedArea * c,
  localGI_corrected = TotalArea_corrected / ExposedArea_corrected,
  logTotalArea_corrected = log10(TotalArea_corrected),
  logExposedArea_corrected = log10(ExposedArea_corrected),
  logkteorico_corrected = 1 / 2 * logAvgThickness + logTotalArea_corrected - 5 / 4 * logExposedArea_corrected
) %>% filter(ROI != "Insula")

LobesExtract_ALL_results$Session <- as.double(LobesExtract_ALL_results$Session)
